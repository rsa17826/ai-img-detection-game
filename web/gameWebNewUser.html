<!DOCTYPE html>
<html>
  <head>
    <title>game add new user</title>
    <script type="text/javascript" src="/eel.js"></script>
    <script type="text/javascript" src="./libloader.js"></script>
    <script type="text/javascript" src="./allfuncs.js"></script>
    <script type="text/javascript" src="./toast.js"></script>
    <script type="text/javascript" src="./progressBar.js"></script>
    <script type="text/javascript" src="./log.js"></script>
    <script type="text/javascript">
      const a = loadlib("allfuncs")
      const BLANK_IMAGE =
        "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
      ;(async () => {
        await a.bodyload()
        await a.waituntil(() => eel._websocket)
        eel._websocket.onclose = window.close.bind(window)
        eel.requestUpdatedData()
        eel.expose(loadData)
        eel.expose(hideProg)
        eel.expose(setProg)
        function setProg(prog, maxProg, name) {
          if (!window.progBar) {
            window.progBar = new (loadlib("progress bar"))(
              prog,
              maxProg
            )
          }
          window.progBar.set(prog, name)
        }
        function hideProg() {
          if (window.progBar) window.progBar.remove()
          window.progBar = null
        }
        function loadData({
          captureIdx,
          setminconfidenceInput,
          TARGET_CONFIDENCE,
          enableAutoCapture,
        }) {
          // a.qs("#captureIdx").value = captureIdx
          // a.qs("#setminconfidenceInput").value = setminconfidenceInput
          // a.qs("#TARGET_CONFIDENCE").value = TARGET_CONFIDENCE
          // a.qs("#enableAutoCapture").value = enableAutoCapture
          // eel.updateFacesList()
        }
        window.toast = loadlib("toast")
        a.listen("#captureIdx", "change", function (e) {
          eel.startCapture(a.qs("#captureIdx").value)
          eel.updateFacesList()
        })
        // a.listen("#enableAutoCapture", "change", function (e) {
        //   eel.setenableAutoCapture(a.qs("#enableAutoCapture").checked)
        // })
        // a.listen("#TARGET_CONFIDENCE", "change", function (e) {
        //   eel.setTARGET_THRESH(a.qs("#TARGET_CONFIDENCE").value)
        // })
        a.listen("#updateFacesList", "click", function (e) {
          eel.updateFacesList()
        })
        a.listen("#addFaceToList", "click", function (e) {
          eel.addFaceToList(
            a.qs("#faceName").value || prompt("person name")
          )
        })
        a.listen("#captureBtn", "click", function (e) {
          eel.startCapture(a.qs("#captureIdx").value)
        })
        a.listen("#stopCaptureBtn", "click", function (e) {
          eel.stopCapture()
        })
        a.listen(
          "#setminconfidenceInput",
          ["input", "change"],
          function (e) {
            eel.jsSetminconfidence(
              a.qs("#setminconfidenceInput").value
            )
          }
        )
      })()
      eel.expose(print)
      function print(...msgs) {
        if (msgs.join(" - ") && msgs.length && msgs?.[0]) {
          console.log(...msgs)
          toast(msgs.join(" - "), "green")
        }
      }
      eel.expose(receive_frame)
      function receive_frame(encoded_frame) {
        a.qs("#cameraFeed").src = encoded_frame
      }
    </script>
  </head>
  <style>
    * {
      color: white;
    }
    button,
    input {
      background-color: #777;
      border: none;
      margin: 4px;
    }
    .v {
      display: flex;
      flex-direction: column;
    }
    .h {
      display: flex;
      flex-direction: row;
    }
    .c {
      align-items: center;
      align-content: center;
      align-self: center;
    }
    #cameraFeed {
      --size: calc(100vh - 100px);
      height: var(--size);
      min-width: var(--size);
      max-width: calc(100vw - 20px);
      margin: 4px;
      border: 10px solid black;
      /* --size: calc(100vh - 140px);
      max-height: var(--size);
      max-width: calc(100vw - 20px);
      margin: 4px;
      border: 10px solid black; */
    }
    body,
    html {
      overflow: hidden;
      background-color: #111;
    }
    #imp {
      position: absolute;
      top: 40px;
      left: 30px;
    }
    #imp,
    #imp > *,
    #imp > * > *,
    #imp > * > * > * {
      pointer-events: none;
      font-weight: bolder;
      color: rgb(226, 0, 0);
      --text-shadow-color: rgb(207, 126, 126);
      text-shadow: -1px 0 var(--text-shadow-color),
        0 1px var(--text-shadow-color),
        1px 0 var(--text-shadow-color),
        0 -1px var(--text-shadow-color);
      z-index: 9999999999;
      padding: none;
      margin: none;
      gap: none;
    }
  </style>
  <body>
    <div id="imp">
      <h2>
        IMPORTANT!!!<br />after entering your name press "add face to
        list"
        <br />
        (ONLY PRESS THIS IF YOU ARE THE PERSON THAT HAS THEIR FACE
        SELECTED BY THE RED BOX!)
        <br />then move after it loads move around and it will auto
        capture more images if required
      </h2>
    </div>
    <div class="v">
      <div class="v c">
        <div class="h">
          <label for="captureIdx">Camera Index:</label>
          <input
            title="what camera to use"
            type="number"
            name="captureIdx"
            id="captureIdx"
            value="1"
          />
          <button id="captureBtn">‚ñ∂Ô∏è Start Capture</button>
          <button id="stopCaptureBtn">üü• Stop Capture</button>
        </div>
        <!-- <div class="h">
          <label for="setminconfidenceInput">Min Confidence:</label>
          <input
            title="min Confidence for any detections"
            type="number"
            name="setminconfidenceInput"
            id="setminconfidenceInput"
            step="0.01"
            value="0.6"
            min="-1"
            max="1"
          />
          <label for="TARGET_CONFIDENCE">Target Confidence:</label>
          <input
            title="if Auto Capture is enabled and a person is detected with less than this in confidence a new image will be saved to increate confidence"
            type="number"
            name="TARGET_CONFIDENCE"
            id="TARGET_CONFIDENCE"
            step="0.01"
            value="0.6"
            min="-1"
            max="1"
          />
          <label for="enableAutoCapture">Enable Auto Capture:</label>
          <input
            title="if enabled Target Confidence is used"
            type="checkbox"
            name="enableAutoCapture"
            id="enableAutoCapture"
          /> -->
        <!-- </div> -->
        <div class="h">
          <button id="updateFacesList">update faces list</button>
          <label for="faceName">face name:</label>
          <input
            title="name of the face that is being captured when add face to list gets pressed"
            type="text"
            name="faceName"
            id="faceName"
          />
          <button id="addFaceToList">add face to list</button>
        </div>
      </div>
      <div class="c">
        <img
          id="cameraFeed"
          alt="Camera Feed"
          src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
        />
      </div>
    </div>
  </body>
</html>
